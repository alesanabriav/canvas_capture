<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>sanabriav - Cam</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha/css/bootstrap.css">
</head>
<body>
  <div class="container-fluid">
    <div class="col-md-6">
      <video id="videoElement"></video>
    </div>
    <div class="col-md-6">
      <canvas id="canvas"></canvas>
    </div>
  </div>
  <div class="container">
    <button id="capture">Capture</button>
  <div class="form-group">
    <label for="">Red</label>
    <input step="0.1" min="0" max="1" type="range" id="preset-red">
  </div>
  <div class="form-group">
    <label for="">Green</label>
    <input step="0.1" min="0" max="1" type="range" id="preset-green">
  </div>
  <div class="form-group">
    <label for="">Blue</label>
    <input step="0.1" min="0" max="1" type="range" id="preset-blue">
  </div>

  <div class="form-group">
    <label for="">Gradient</label>
    <input step="10" min="0" max="200" type="range" id="preset-gradient">
  </div>

  </div>

<script>

  var video = document.querySelector("#videoElement");
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext('2d');

navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
 
if (navigator.getUserMedia) {      
    navigator.getUserMedia({video: true}, handleVideo, videoError);
}
 
function handleVideo(stream) {
    video.src = window.URL.createObjectURL(stream);
  video.play();
}
 
function videoError(e) {
    console.log(e);
}


document.getElementById('capture').addEventListener('click', function(e) {
  getCapture();
});

function getColor(range) {
  ctx.globalCompositeOperation = "overlay";
  range = range ? parseInt(range) : 0;
  var grd = ctx.createRadialGradient(range, range, canvas.width, range, 0, 0);
  grd.addColorStop(0,"blue");
  grd.addColorStop(1,"#FF4F59");

  ctx.fillStyle= grd;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

  var presetRed = 1;
  var presetGreen = 1;
  var presetBlue = 1;
  var presetGradient = 0;

  document.getElementById('preset-red').addEventListener('change', function() {
    presetRed = this.value;
    handleColors();
  });

  document.getElementById('preset-green').addEventListener('change', function() {
    presetGreen = this.value;
    handleColors();
  });

  document.getElementById('preset-blue').addEventListener('change', function() {
    presetBlue = this.value;
    handleColors();
  });

  document.getElementById('preset-gradient').addEventListener('change', function() {
    presetGradient = this.value;
    handleColors();
  });

  function handleColors() {
    getCapture(presetRed, presetGreen, presetBlue, presetGradient);
  }

  function setRgb(pixels, pr = 1, pg = 1, pb = 1) {
    var d = pixels.data;

    for (var i = 0; i < d.length; i += 4) {
      var r = d[i];
      var g = d[i + 1];
      var b = d[i + 2];

      d[i] =  r * pr + 100; // red
      d[i + 1] = g * pg + 100; // green
      d[i + 2] = b * pb + 100; // blue
    }
    return pixels;
  };

function getCapture(red, green, blue, gradient) {

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(video, 0, 0);

  var imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

  imgData = setRgb(imgData, red, green, blue);

  ctx.putImageData(imgData, 0, 0);

  getColor(gradient);
}

</script>
</body>
</html>
